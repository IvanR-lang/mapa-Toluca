<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        const map = L.map('map', { zoomControl: false }).setView([19.2827, -99.6557], 15);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
        let marcadoresActuales = [];
        let siguiendo = true;

        // ... (el resto de tus funciones de GPS)

        async function cargarPuntos() {
            try {
                const res = await fetch('/api/chat');
                const puntos = await res.json();
                marcadoresActuales.forEach(m => map.removeLayer(m));
                
                puntos.forEach(p => {
                    const iconoEmoji = p.texto.split(' ')[0];
                    const m = L.marker([p.lat, p.lng], {
                        icon: L.divIcon({ html: `<div style="font-size: 28px;">${iconoEmoji}</div>`, className: 'dummy' })
                    }).addTo(map);

                    // POPUP CON BOTÃ“N ELIMINAR
                    const popupContent = `
                        <div style="text-align:center;">
                            <b>${p.texto}</b><br>
                            <small>ðŸ•’ ${p.fecha}</small><br><br>
                            <button onclick="confirmarEliminar('${p._id}', '${p.texto}')" 
                                style="background:#ff4444; color:white; border:none; padding:5px 10px; border-radius:5px; cursor:pointer;">
                                Eliminar
                            </button>
                        </div>`;
                    m.bindPopup(popupContent);
                    marcadoresActuales.push(m);
                });
            } catch (e) {}
        }

        // DOBLE BARRERA DE SEGURIDAD
        async function confirmarEliminar(id, nombre) {
            if (confirm("Â¿Quieres eliminar este reporte?")) {
                if (confirm(`Â¿EstÃ¡s seguro de que ${nombre} ya no estÃ¡?`)) {
                    await fetch(`/api/chat/${id}`, { method: 'DELETE' });
                    cargarPuntos();
                }
            }
        }
        setInterval(cargarPuntos, 5000);
        cargarPuntos();
    </script>
