// Busca la funci칩n cargarPuntos en tu index.html y reempl치zala por esta:
async function cargarPuntos() {
    try {
        const res = await fetch('/api/chat');
        const puntos = await res.json();
        marcadoresActuales.forEach(m => map.removeLayer(m));
        
        puntos.forEach(p => {
            const iconoEmoji = p.texto.split(' ')[0];
            const nombreReporte = p.texto.split(' ').slice(1).join(' '); // Ejemplo: "RET칄N"

            const m = L.marker([p.lat, p.lng], {
                icon: L.divIcon({ 
                    html: `<div style="font-size: 28px;">${iconoEmoji}</div>`, 
                    className: 'dummy', iconSize: [30, 30], iconAnchor: [15, 15] 
                })
            }).addTo(map);

            // Contenido del Popup con bot칩n de eliminar
            const popupContent = `
                <div style="text-align:center;">
                    <b>${p.texto}</b><br>
                    <small>游 ${p.fecha}</small><br><br>
                    <button onclick="confirmarEliminar('${p._id}', '${p.texto}')" 
                        style="background:#ff4444; color:white; border:none; padding:5px 10px; border-radius:5px; cursor:pointer;">
                        Eliminar
                    </button>
                </div>
            `;
            
            m.bindPopup(popupContent);
            marcadoresActuales.push(m);
        });
    } catch (e) {}
}

// Funci칩n para la doble barrera de eliminaci칩n
async function confirmarEliminar(id, nombre) {
    // Primera barrera
    if (confirm("쯈uieres eliminar este reporte?")) {
        // Segunda barrera personalizada
        if (confirm(`쮼st치s seguro de que ${nombre} ya no est치?`)) {
            await fetch(`/api/chat/${id}`, { method: 'DELETE' });
            cargarPuntos(); // Recargar el mapa
        }
    }
}
